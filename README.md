# Симулятор Kaspi POS-терминала

Данный проект представляет собой симулятор POS-терминала Kaspi, предназначенный для тестирования интеграции с кассовыми системами. Симулятор полностью воспроизводит API реального терминала согласно официальной документации Kaspi.

## Возможности

- Имитация всех методов API Kaspi POS: оплата, возврат, проверка статуса, актуализация и т.д.
- Поддержка HTTP и HTTPS подключений
- Поддержка защищенного API с токенами
- Автоматическое очищение зависших транзакций
- Сброс транзакций через специальный эндпоинт

## Установка

```bash
# Клонируем репозиторий
git clone https://github.com/robotickz/kaspi_pos_terminal_simulator.git
cd kaspi-pos-simulator

# Устанавливаем зависимости
pip install pyopenssl
```

## Запуск

### Обычный режим

```bash
python kaspi_pos_simulator.py
```

### С поддержкой SSL

```bash
python kaspi_pos_simulator.py --ssl
```

### С защищенным API

```bash
python kaspi_pos_simulator.py --secure
```

### Полный набор опций

```bash
python kaspi_pos_simulator.py --host 0.0.0.0 --port 8080 --ssl --secure
```

## Примеры использования

### Получение информации о терминале

```
GET http://localhost:8080/v2/deviceinfo
```

### Запрос на оплату

```
GET http://localhost:8080/v2/payment?amount=1000&owncheque=true
```

### Проверка статуса

```
GET http://localhost:8080/v2/status?processId=1234567890123
```

### Сброс транзакций

```
GET http://localhost:8080/v2/reset
```

## Интеграция с Flutter

В репозитории также есть пример интеграции с Flutter. Основные моменты:

- При обновлении токена необходимо передавать текущий токен доступа в заголовке `accesstoken`
- При ошибке 107 (незавершенная предыдущая транзакция) используйте эндпоинт `/v2/reset`

## Решение проблем

### Проблема с токенами

Если возникает ошибка 401 при обновлении токена, убедитесь, что передаете текущий токен доступа в заголовке `accesstoken`.

### Зависшие транзакции

Если получаете ошибку 107, воспользуйтесь эндпоинтом `/v2/reset` для сброса всех транзакций.

# Примечание
Последнее успешное тестирование симулятора и на реальном устройстве для проверки кода было 12.04.2025
